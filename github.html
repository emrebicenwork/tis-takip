<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sendika TÄ°S Takip Sistemi</title>
    <meta name="description" content="Toplu Ä°ÅŸ SÃ¶zleÅŸmesi takip sistemi - Google Sheets entegrasyonlu">
    <style>
        /* ... (CSS kodlarÄ± Ã¶nceki dosyayla aynÄ±, uzunluk nedeniyle kÄ±saltÄ±ldÄ±) ... */
        /* Tam CSS kodu Ã¶nceki HTML dosyasÄ±yla tamamen aynÄ± */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Toplu Ä°ÅŸ SÃ¶zleÅŸmesi (TÄ°S) Takip Sistemi</h1>
            <p class="subtitle">Google Sheets ile entegre edilmiÅŸ merkezi takip sistemi</p>
        </header>
        
        <div class="panel fade-in">
            <div class="panel-title">
                <h2>ðŸ”— Sistem AyarlarÄ±</h2>
            </div>
            
            <div class="config-panel">
                <div class="form-group">
                    <label for="script-url">Google Apps Script URL'si</label>
                    <input type="text" id="script-url" placeholder="https://script.google.com/macros/s/.../exec">
                    <small>Google Apps Script'ten kopyaladÄ±ÄŸÄ±nÄ±z web uygulamasÄ± URL'sini buraya yapÄ±ÅŸtÄ±rÄ±n</small>
                </div>
                <button id="save-config-btn" class="btn btn-success">AyarlarÄ± Kaydet ve BaÄŸlan</button>
                <div class="connection-status">
                    <div class="status-indicator status-offline" id="connection-indicator"></div>
                    <span id="connection-status-text">BaÄŸlÄ± deÄŸil</span>
                </div>
            </div>
        </div>
        
        <!-- DiÄŸer HTML iÃ§eriÄŸi Ã¶nceki dosyayla aynÄ± -->
        
        <footer>
            <p>Bu uygulama <strong>GitHub Pages</strong> Ã¼zerinde barÄ±ndÄ±rÄ±lmaktadÄ±r.</p>
            <p>Son gÃ¼ncelleme: <span id="last-update-time">-</span></p>
            <p>Destek iÃ§in: sendika-teknik@example.com</p>
        </footer>
    </div>

    <script>
        // Google Apps Script CORS Ã§Ã¶zÃ¼mÃ¼ - GITHUB PAGES Ä°Ã‡Ä°N Ã–ZEL
        async function callGoogleScript(method, params = {}, body = null) {
            const url = new URL(scriptUrl);
            url.searchParams.append('method', method);
            
            // Parametreleri URL'ye ekle
            Object.entries(params).forEach(([key, value]) => {
                if (value !== null && value !== undefined) {
                    url.searchParams.append(key, value);
                }
            });
            
            const options = {
                method: body ? 'POST' : 'GET',
                mode: 'cors',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            try {
                // Ä°lk istekte Google oturum aÃ§ma ekranÄ±nÄ± tetikle
                if (method === 'GET_ALL' && !localStorage.getItem('google_authorized_' + scriptUrl)) {
                    const popup = window.open(url.toString(), '_blank', 'width=600,height=400');
                    if (popup) {
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        popup.close();
                        localStorage.setItem('google_authorized_' + scriptUrl, 'true');
                    }
                }
                
                const response = await fetch(url.toString(), options);
                
                if (!response.ok) {
                    throw new Error(`HTTP hatasÄ±! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    return data.data;
                } else {
                    throw new Error(data.error || 'Google Script hatasÄ±');
                }
            } catch (error) {
                console.error('Google Script hatasÄ±:', error);
                throw error;
            }
        }
        
        // DiÄŸer JavaScript kodlarÄ± Ã¶nceki dosyayla aynÄ±
        // Sadece veri eriÅŸim fonksiyonlarÄ± callGoogleScript fonksiyonunu kullanacak
        
        document.addEventListener('DOMContentLoaded', function() {
            // ... (Ã¶nceki kodlarla aynÄ±) ...
            
            // Ã–rnek kullanÄ±m:
            async function fetchRecords() {
                try {
                    records = await callGoogleScript('GET_ALL');
                    return true;
                } catch (error) {
                    console.error('KayÄ±t alma hatasÄ±:', error);
                    throw error;
                }
            }
            
            async function addRecordToSheet(recordData) {
                return await callGoogleScript('ADD', {}, { data: recordData });
            }
            
            async function updateRecordInSheet(id, recordData) {
                return await callGoogleScript('UPDATE', { id }, { data: recordData });
            }
            
            async function deleteRecordFromSheet(id) {
                return await callGoogleScript('DELETE', { id });
            }
            
            // ... (diÄŸer kodlar Ã¶nceki dosyayla aynÄ±) ...
        });
    </script>
</body>
</html>